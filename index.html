<!DOCTYPE html>
<html>

<head>
  <title>Revision App</title>
  <link rel="stylesheet" href="styleslogin.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

</head>

<body>


  <div>
    <form class='user-forms'>
      <label for='Username'>Username</label><br>
      <input type='text' id='Username' username=username><br>
      <label for='Password'>Password</label><br>
      <input type='text' id='Password' password=password><br>

      <button type="button" id='btnSubmit'>Submit</button>


    </form>
  </div>

  <script>

    //The supabase url
    const supabase_url = 'https://pxjndwrkafegopsolnde.supabase.co'
    //Supabase key
    const supabase_key = 'sb_publishable_eOUJ3K3GNczOncszRwYhyA_A1QAw72F'
    //Initialize supabase client
    const supabaseClient = supabase.createClient(
    'https://pxjndwrkafegopsolnde.supabase.co',
    'sb_publishable_eOUJ3K3GNczOncszRwYhyA_A1QAw72F'
    );
    

    //fetch the data from the username field
    let usernameElement = document.getElementById('Username');
    let passwordElement = document.getElementById('Password');

async function checkCredentials() {
  console.log("Checking credentials for:", usernameElement.value);
  
  const { data, error } = await supabaseClient
    .from('userinfo')
    .select('username, password_hash')  // Changed to single string
    .eq('username', usernameElement.value);
  
  console.log("Query response:", { data, error });
  
  if(error) {
    console.log('Database error:', error.message);
  }
  else if (!data || data.length === 0) {  // Check if array is empty
    console.log('Username not found - no data returned');
  }
  else {
    console.log('User found:', data[0]);  // Debug what we got
    
    // Check the correct property name
    if (data[0].password_hash === passwordElement.value) {
      console.log('Log In successful');
    }
    else {
      console.log('Password Incorrect');
      console.log('Entered:', passwordElement.value);
      console.log('Stored:', data[0].password_hash);
    }
  }
};

    document.addEventListener('DOMContentLoaded', function () {
      //Get the element of the submit button   
      let button = document.getElementById('btnSubmit');
      // Add event listener to the button
      button.addEventListener('click', function () {

        //log the value of the username form to the console
        console.log(usernameElement.value);
        checkCredentials()
      });


    });


  </script>
</body>

</html>
